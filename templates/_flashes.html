{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{# Render up to 3 most recent unique flash messages (deduplicated) and apply category as CSS class #}
<style>
  .flash { margin: 12px 0; padding: 10px 12px; border-radius: 8px; }
  .flash.success { background: #ecfdf5; color: #065f46; border: 1px solid #bbf7d0; }
  .flash.info    { background: #eef2ff; color: #1e3a8a; border: 1px solid #bfdbfe; }
  .flash.warning { background: #fff7ed; color: #92400e; border: 1px solid #fed7aa; }
  .flash.danger  { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
</style>
{% set ns = namespace(seen=[], shown=0) %}
{% for category, message in messages|reverse %}
  {% if ns.shown >= 3 %}
    {# limit reached #}
  {% else %}
    {% if message not in ns.seen %}
      {% set _ = ns.seen.append(message) %}
      <div class="flash {{ category|e }}">{{ message }}</div>
      {% set ns.shown = ns.shown + 1 %}
    {% endif %}
  {% endif %}
{% endfor %}
{% endif %}
{% endwith %}
